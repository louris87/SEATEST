<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SeamanAgency - Naval Command Center</title>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

  <style>
    :root {
      /* Navy Classic Premium Colors */
      --navy-dark: #0a192f;
      --navy-medium: #112240;
      --navy-light: #233554;
      --navy-card: rgba(17, 34, 64, 0.85);
      --navy-card-hover: rgba(35, 53, 84, 0.9);
      --navy-border: rgba(136, 146, 176, 0.2);
      --navy-border-light: rgba(204, 214, 246, 0.15);
      
      /* Gold Accent Colors */
      --gold-primary: #d4af37;
      --gold-light: #e6c76e;
      --gold-dark: #b8941f;
      --gold-glow: rgba(212, 175, 55, 0.4);
      
      /* Silver & Metallic Accents */
      --silver-accent: #c0c0c0;
      --silver-light: #e8e8e8;
      
      /* Text Colors */
      --text-cream: #e6f1ff;
      --text-offwhite: #ccd6f6;
      --text-muted: #8892b0;
      --text-light: #a8b2d1;
      
      /* Status Colors */
      --success: #50fa7b;
      --warning: #f1fa8c;
      --danger: #ff5555;
      --info: #8be9fd;
      
      /* Glass Effects */
      --glass-border: 1px solid rgba(212, 175, 55, 0.15);
      --glass-shadow: 0 15px 35px rgba(10, 25, 47, 0.6);
      --glass-backdrop: blur(12px) saturate(180%);
      --card-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.4);
      --gold-glow-effect: 0 0 20px rgba(212, 175, 55, 0.25);
      
      /* Gradients */
      --navy-gradient: linear-gradient(135deg, #0a192f 0%, #112240 50%, #0a192f 100%);
      --gold-gradient: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
      --silver-gradient: linear-gradient(135deg, #c0c0c0 0%, #a0a0a0 100%);
      --card-gradient: linear-gradient(135deg, rgba(17, 34, 64, 0.9) 0%, rgba(10, 25, 47, 0.9) 100%);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: var(--navy-gradient);
      background-attachment: fixed;
      color: var(--text-cream);
      line-height: 1.6;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      font-family: 'Inter', sans-serif;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 10% 20%, rgba(212, 175, 55, 0.08) 0%, transparent 40%),
        radial-gradient(circle at 90% 80%, rgba(10, 25, 47, 0.8) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(35, 53, 84, 0.3) 0%, transparent 50%);
      z-index: -1;
      pointer-events: none;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(17, 34, 64, 0.6);
      border-radius: 10px;
      backdrop-filter: var(--glass-backdrop);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--gold-gradient);
      border-radius: 10px;
      border: 2px solid rgba(17, 34, 64, 0.6);
    }
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #e6c76e 0%, #d4af37 100%);
      box-shadow: var(--gold-glow-effect);
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    
    /* Header - Naval Style */
    header {
      background: rgba(17, 34, 64, 0.85);
      border: var(--glass-border);
      padding: 20px 40px;
      border-radius: 16px;
      margin-bottom: 40px;
      box-shadow: var(--glass-shadow);
      position: sticky;
      top: 20px;
      z-index: 1000;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      border-left: 4px solid var(--gold-primary);
      border-right: 4px solid var(--gold-primary);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 32px;
      font-weight: 700;
      color: var(--text-cream);
      letter-spacing: 1px;
      position: relative;
      padding-left: 60px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    h1::before {
      content: 'âš“';
      position: absolute;
      left: 0;
      font-size: 36px;
      color: var(--gold-primary);
      text-shadow: 0 0 10px var(--gold-glow);
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--gold-gradient);
      border-radius: 2px;
    }
    
    .sync-status {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      font-weight: 500;
      background: rgba(10, 25, 47, 0.8);
      padding: 12px 24px;
      border-radius: 8px;
      border: 1px solid rgba(212, 175, 55, 0.2);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      font-family: 'Inter', monospace;
    }
    
    .sync-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      position: relative;
    }
    
    .sync-indicator::before {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    .sync-indicator.connected {
      background-color: var(--success);
      box-shadow: 0 0 10px rgba(80, 250, 123, 0.5);
    }
    
    .sync-indicator.connected::before {
      background: rgba(80, 250, 123, 0.3);
    }
    
    .sync-indicator.syncing {
      background-color: var(--warning);
      box-shadow: 0 0 10px rgba(241, 250, 140, 0.5);
    }
    
    .sync-indicator.syncing::before {
      background: rgba(241, 250, 140, 0.3);
    }
    
    .sync-indicator.error {
      background-color: var(--danger);
      box-shadow: 0 0 10px rgba(255, 85, 85, 0.5);
    }
    
    .sync-indicator.error::before {
      background: rgba(255, 85, 85, 0.3);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    #userEmail {
      font-size: 14px;
      color: var(--text-offwhite);
      background: rgba(10, 25, 47, 0.8);
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid rgba(212, 175, 55, 0.2);
      backdrop-filter: var(--glass-backdrop);
      font-family: 'Inter', monospace;
      letter-spacing: 0.5px;
    }
    
    /* Buttons - Naval Design */
    .btn-group {
      display: flex;
      gap: 20px;
      margin-bottom: 40px;
      flex-wrap: wrap;
      padding: 20px;
      background: rgba(17, 34, 64, 0.7);
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.1);
    }
    
    button {
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      font-family: 'Inter', sans-serif;
      border: 1px solid transparent;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
      transition: left 0.6s;
    }
    
    button:hover::before {
      left: 100%;
    }
    
    button i {
      font-size: 16px;
      transition: transform 0.3s;
    }
    
    button:hover i {
      transform: scale(1.2) rotate(5deg);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(184, 148, 31, 0.2) 100%);
      color: var(--text-cream);
      border: 1px solid rgba(212, 175, 55, 0.3);
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.15);
      position: relative;
    }
    
    .btn-primary::after {
      content: '';
      position: absolute;
      top: 1px;
      left: 1px;
      right: 1px;
      height: 30%;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
      border-radius: 8px 8px 0 0;
      pointer-events: none;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.3) 0%, rgba(184, 148, 31, 0.3) 100%);
      transform: translateY(-3px);
      border-color: var(--gold-primary);
      box-shadow: 0 8px 25px rgba(212, 175, 55, 0.25), inset 0 0 20px rgba(212, 175, 55, 0.1);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, rgba(35, 53, 84, 0.4) 0%, rgba(17, 34, 64, 0.4) 100%);
      color: var(--text-offwhite);
      border: 1px solid rgba(136, 146, 176, 0.2);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, rgba(53, 71, 104, 0.4) 0%, rgba(35, 53, 84, 0.4) 100%);
      transform: translateY(-3px);
      border-color: var(--silver-accent);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(255, 255, 255, 0.05);
    }
    
    .logout-btn {
      background: linear-gradient(135deg, rgba(255, 85, 85, 0.1) 0%, rgba(220, 50, 50, 0.1) 100%);
      border: 1px solid rgba(255, 85, 85, 0.3);
      color: #ff9999;
      padding: 10px 20px;
      font-size: 13px;
      box-shadow: 0 4px 15px rgba(255, 85, 85, 0.1);
    }
    
    .logout-btn:hover {
      background: linear-gradient(135deg, rgba(255, 85, 85, 0.2) 0%, rgba(220, 50, 50, 0.2) 100%);
      color: #fff;
      border-color: var(--danger);
      box-shadow: 0 8px 25px rgba(255, 85, 85, 0.2), inset 0 0 20px rgba(255, 85, 85, 0.1);
    }
    
    /* Card Action Buttons */
    .btn-edit {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(230, 199, 110, 0.15) 100%);
      border: 1px solid rgba(212, 175, 55, 0.3);
      color: var(--gold-light);
      padding: 10px 18px;
      font-size: 12px;
      border-radius: 6px;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(212, 175, 55, 0.1);
    }
    
    .btn-edit:hover {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.3) 0%, rgba(230, 199, 110, 0.3) 100%);
      color: white;
      border-color: var(--gold-primary);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.2);
    }
    
    .btn-delete {
      background: linear-gradient(135deg, rgba(255, 85, 85, 0.15) 0%, rgba(220, 50, 50, 0.15) 100%);
      border: 1px solid rgba(255, 85, 85, 0.3);
      color: #ff9999;
      padding: 10px 18px;
      font-size: 12px;
      border-radius: 6px;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(255, 85, 85, 0.1);
    }
    
    .btn-delete:hover {
      background: linear-gradient(135deg, rgba(255, 85, 85, 0.3) 0%, rgba(220, 50, 50, 0.3) 100%);
      color: white;
      border-color: var(--danger);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 85, 85, 0.2);
    }
    
    /* Loading */
    .loading {
      display: none;
      text-align: center;
      padding: 60px;
      background: rgba(17, 34, 64, 0.85);
      border-radius: 16px;
      backdrop-filter: var(--glass-backdrop);
      border: var(--glass-border);
      margin: 20px 0;
    }
    
    .spinner {
      border: 3px solid rgba(136, 146, 176, 0.2);
      border-top: 3px solid var(--gold-primary);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
      position: relative;
    }
    
    .spinner::before {
      content: '';
      position: absolute;
      top: -5px;
      left: -5px;
      right: -5px;
      bottom: -5px;
      border-radius: 50%;
      border: 2px solid transparent;
      border-top: 2px solid var(--gold-light);
      animation: spin 1.5s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.1); }
    }
    
    /* Containers */
    .search-container,
    .form-container,
    .login-container,
    .title-dialog {
      background: var(--card-gradient);
      border: var(--glass-border);
      padding: 40px;
      border-radius: 16px;
      box-shadow: var(--glass-shadow);
      margin-bottom: 30px;
      animation: fadeIn 0.5s ease;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      border-top: 2px solid var(--gold-primary);
      border-bottom: 2px solid var(--gold-primary);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Form Elements */
    input,
    select,
    textarea {
      width: 100%;
      padding: 15px 20px;
      background: rgba(10, 25, 47, 0.8);
      border: 1px solid rgba(136, 146, 176, 0.2);
      border-radius: 8px;
      color: var(--text-cream);
      font-size: 15px;
      transition: all 0.4s;
      backdrop-filter: var(--glass-backdrop);
      font-family: 'Inter', sans-serif;
    }
    
    input:hover,
    select:hover,
    textarea:hover {
      border-color: rgba(212, 175, 55, 0.4);
    }
    
    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--gold-primary);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2), inset 0 0 20px rgba(212, 175, 55, 0.1);
      background: rgba(10, 25, 47, 0.9);
    }
    
    label {
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      font-family: 'Inter', sans-serif;
    }
    
    .search-container {
      display: none;
    }
    
    .search-box {
      display: flex;
      gap: 20px;
    }
    
    .form-container {
      display: none;
    }
    
    .form-title {
      font-family: 'Playfair Display', serif;
      font-size: 32px;
      margin-bottom: 30px;
      color: var(--text-cream);
      display: flex;
      align-items: center;
      gap: 15px;
      position: relative;
      padding-bottom: 15px;
    }
    
    .form-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100px;
      height: 3px;
      background: var(--gold-gradient);
      border-radius: 2px;
    }
    
    .form-title i {
      color: var(--gold-primary);
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
    }
    
    /* Checkbox Groups */
    .checkbox-group {
      background: rgba(10, 25, 47, 0.8);
      padding: 30px;
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.2);
      margin-top: 30px;
      backdrop-filter: var(--glass-backdrop);
    }
    
    .checkbox-section-title {
      color: var(--gold-light);
      border-bottom: 1px solid rgba(212, 175, 55, 0.3);
      padding-bottom: 15px;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: 600;
      font-family: 'Playfair Display', serif;
      letter-spacing: 0.5px;
    }
    
    .checkbox-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
    }
    
    .checkbox-item {
      background: rgba(35, 53, 84, 0.5);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid rgba(136, 146, 176, 0.1);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    
    .checkbox-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--gold-gradient);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .checkbox-item:hover {
      background: rgba(53, 71, 104, 0.6);
      border-color: rgba(212, 175, 55, 0.3);
      transform: translateY(-2px);
    }
    
    .checkbox-item:hover::before {
      opacity: 1;
    }
    
    .checkbox-item label {
      text-transform: none;
      letter-spacing: normal;
      color: var(--text-offwhite);
      cursor: pointer;
      font-weight: 400;
      font-size: 14px;
    }
    
    .checkbox-item input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.2);
      accent-color: var(--gold-primary);
    }
    
    /* Login */
    .login-container {
      display: none;
      max-width: 480px;
      margin: 10vh auto;
      text-align: center;
      border-top: 4px solid var(--gold-primary);
      position: relative;
      overflow: hidden;
    }
    
    .login-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gold-gradient);
      animation: slideIn 1s ease;
    }
    
    @keyframes slideIn {
      from { width: 0; }
      to { width: 100%; }
    }
    
    .login-container h2 {
      margin-bottom: 30px;
      color: var(--text-cream);
      font-size: 36px;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      letter-spacing: 1px;
    }
    
    .login-btn {
      width: 100%;
      justify-content: center;
      margin-top: 30px;
      padding: 18px;
      font-size: 16px;
      background: var(--gold-gradient);
      color: #0a192f !important;
      border: none !important;
      box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3) !important;
      font-weight: 700;
      letter-spacing: 1.5px;
    }
    
    .login-btn:hover {
      background: linear-gradient(135deg, #e6c76e 0%, #d4af37 100%) !important;
      box-shadow: 0 12px 30px rgba(212, 175, 55, 0.4) !important;
      transform: translateY(-3px) !important;
      color: #0a192f !important;
    }
    
    /* Profile Cards */
    .profile-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
      gap: 30px;
    }
    
    .profile-card {
      background: var(--card-gradient);
      border: 1px solid rgba(212, 175, 55, 0.2);
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      box-shadow: var(--card-shadow);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
    }
    
    .profile-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--gold-gradient);
      opacity: 0.8;
      transition: opacity 0.3s;
    }
    
    .profile-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.05), transparent);
      transition: left 0.7s;
    }
    
    .profile-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 30px 50px -20px rgba(0, 0, 0, 0.5), var(--gold-glow-effect);
      border-color: rgba(212, 175, 55, 0.4);
      background: linear-gradient(135deg, rgba(35, 53, 84, 0.9) 0%, rgba(17, 34, 64, 0.9) 100%);
    }
    
    .profile-card:hover::before {
      opacity: 1;
    }
    
    .profile-card:hover::after {
      left: 100%;
    }
    
    .card-header {
      background: rgba(10, 25, 47, 0.8);
      padding: 25px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .card-header-info {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .card-avatar {
      width: 60px;
      height: 60px;
      background: var(--gold-gradient);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: #0a192f;
      font-weight: 700;
      box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
      font-family: 'Playfair Display', serif;
      position: relative;
      overflow: hidden;
    }
    
    .card-avatar::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      transition: all 0.5s;
    }
    
    .card-avatar:hover::before {
      left: 100%;
    }
    
    .card-header h3 {
      font-size: 20px;
      color: var(--text-cream);
      margin-bottom: 5px;
      font-family: 'Playfair Display', serif;
    }
    
    .card-header p {
      color: var(--gold-light);
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .card-actions {
      display: flex;
      gap: 10px;
    }
    
    .card-body {
      padding: 25px;
    }
    
    .card-detail {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px dashed rgba(136, 146, 176, 0.3);
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .card-detail:hover {
      border-bottom-color: rgba(212, 175, 55, 0.5);
    }
    
    .card-detail:last-child {
      border-bottom: none;
    }
    
    .detail-label {
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }
    
    .detail-label i {
      font-size: 14px;
      color: var(--gold-primary);
      width: 20px;
      text-align: center;
    }
    
    .detail-value {
      color: var(--text-offwhite);
      font-weight: 500;
      text-align: right;
    }
    
    /* Progress Bar */
    .progress-bar {
      height: 8px;
      background-color: rgba(10, 25, 47, 0.8);
      border-radius: 10px;
      margin-top: 12px;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(136, 146, 176, 0.1);
    }
    
    .progress {
      height: 100%;
      background: var(--gold-gradient);
      border-radius: 10px;
      transition: width 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    
    .progress::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    /* No Results */
    .no-results {
      grid-column: 1 / -1;
      text-align: center;
      padding: 80px;
      color: var(--text-muted);
      background: rgba(10, 25, 47, 0.8);
      border-radius: 16px;
      border: 2px dashed rgba(212, 175, 55, 0.3);
      backdrop-filter: var(--glass-backdrop);
    }
    
    .no-results i {
      font-size: 48px;
      margin-bottom: 20px;
      opacity: 0.5;
      color: var(--gold-primary);
    }
    
    /* Footer */
    footer {
      text-align: center;
      margin-top: 80px;
      padding: 40px;
      color: var(--text-muted);
      font-size: 14px;
      border-top: 1px solid rgba(212, 175, 55, 0.2);
      background: rgba(10, 25, 47, 0.5);
      border-radius: 16px;
      backdrop-filter: var(--glass-backdrop);
      position: relative;
    }
    
    footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 2px;
      background: var(--gold-gradient);
    }
    
    /* Title Dialog */
    .title-dialog {
      display: none;
      max-width: 700px;
      margin: 0 auto;
      text-align: center;
      position: relative;
    }
    
    .title-dialog::before {
      content: 'âš“';
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 48px;
      color: var(--gold-primary);
      background: rgba(10, 25, 47, 0.9);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
    }
    
    .title-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-top: 40px;
    }
    
    .title-option {
      background: rgba(10, 25, 47, 0.8);
      border: 2px solid rgba(212, 175, 55, 0.2);
      border-radius: 12px;
      padding: 40px 25px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
      position: relative;
      overflow: hidden;
      backdrop-filter: var(--glass-backdrop);
    }
    
    .title-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(136, 146, 176, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .title-option:hover {
      background: rgba(35, 53, 84, 0.9);
      transform: translateY(-8px);
      border-color: var(--gold-primary);
      box-shadow: 0 20px 40px rgba(10, 25, 47, 0.4), var(--gold-glow-effect);
    }
    
    .title-option:hover::before {
      opacity: 1;
    }
    
    .title-option.active {
      background: rgba(212, 175, 55, 0.2);
      border-color: var(--gold-primary);
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
    }
    
    .title-option i {
      font-size: 48px;
      margin-bottom: 20px;
      color: var(--gold-primary);
      transition: transform 0.3s;
    }
    
    .title-option:hover i {
      transform: scale(1.2) rotate(10deg);
    }
    
    .title-option h3,
    .title-option h4 {
      color: var(--text-cream);
      margin-bottom: 10px;
      font-size: 20px;
      font-family: 'Playfair Display', serif;
    }
    
    .title-option p {
      color: var(--text-muted);
      font-size: 14px;
    }
    
    /* Sub Options */
    .sub-options {
      display: none;
      margin-top: 30px;
      padding: 30px;
      background: rgba(10, 25, 47, 0.8);
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.2);
      backdrop-filter: var(--glass-backdrop);
    }
    
    .sub-options.active {
      display: block;
    }
    
    /* Webcam */
    .webcam-container {
      grid-column: 1 / -1;
      background: rgba(10, 25, 47, 0.8);
      padding: 30px;
      border-radius: 12px;
      border: 2px solid rgba(212, 175, 55, 0.2);
      margin-top: 30px;
      backdrop-filter: var(--glass-backdrop);
      position: relative;
    }
    
    .webcam-container::before {
      content: 'ðŸ“¸';
      position: absolute;
      top: -15px;
      left: 30px;
      background: var(--navy-medium);
      padding: 0 15px;
      font-size: 18px;
      color: var(--gold-primary);
      z-index: 1;
    }
    
    .webcam-preview {
      width: 100%;
      max-width: 450px;
      height: 350px;
      background: rgba(35, 53, 84, 0.6);
      border-radius: 12px;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 2px solid rgba(212, 175, 55, 0.3);
      position: relative;
    }
    
    .webcam-preview::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: var(--gold-gradient);
      border-radius: 14px;
      z-index: -1;
      opacity: 0.3;
    }
    
    .webcam-preview video,
    .webcam-preview canvas,
    .webcam-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }
    
    .webcam-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    
    /* Date Search */
    .date-search {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    
    .date-search input {
      flex: 1;
    }
    
    /* Utility Classes */
    .hidden-field {
      display: none;
    }
    
    /* Text Colors */
    .text-primary { color: var(--gold-primary); }
    .text-success { color: var(--success); }
    .text-warning { color: var(--warning); }
    .text-danger { color: var(--danger); }
    .text-info { color: var(--info); }
    .text-muted { color: var(--text-muted); }
    
    /* Form Actions */
    .form-actions {
      text-align: center;
      margin-top: 50px;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding-top: 30px;
      border-top: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 20px 15px;
      }
      
      header {
        padding: 15px 20px;
      }
      
      .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      h1 {
        font-size: 24px;
        padding-left: 0;
        text-align: center;
      }
      
      h1::before {
        position: relative;
        display: block;
        margin: 0 auto 10px;
      }
      
      .title-options {
        grid-template-columns: 1fr;
      }
      
      .profile-cards {
        grid-template-columns: 1fr;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .search-box,
      .date-search {
        flex-direction: column;
      }
      
      .btn-group {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <h1>NAVAL COMMAND CENTER</h1>
        <div class="sync-status">
          <div class="sync-indicator" id="syncIndicator"></div>
          <span id="syncStatus">Initializing Naval Database...</span>
        </div>
        <div class="user-info" id="userInfo" style="display:none">
          <span id="userEmail">commander@navy.mm</span>
          <button id="logoutBtn" class="logout-btn"><i class="fa-solid fa-flag"></i> Logout</button>
        </div>
      </div>
    </header>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p id="loadingText">Accessing Naval Records...</p>
    </div>

    <div id="loginContainer" class="login-container">
      <h2>Secure Access</h2>
      <form id="loginForm" class="login-form">
        <div class="form-group" style="margin-bottom:25px;text-align:left">
          <label for="email"><i class="fa-solid fa-envelope"></i> Command Email</label>
          <input type="email" id="email" placeholder="commander@navy.mm" required/>
        </div>
        <div class="form-group" style="margin-bottom:25px;text-align:left">
          <label for="password"><i class="fa-solid fa-key"></i> Security Code</label>
          <input type="password" id="password" placeholder="â—â—â—â—â—â—â—â—" required/>
        </div>
        <button type="submit" class="login-btn btn-primary"><i class="fa-solid fa-shield"></i> ACCESS COMMAND CENTER</button>
      </form>
    </div>

    <div id="mainContent" style="display:none">
      <div class="btn-group">
        <button id="addDataBtn" class="btn-primary"><i class="fa-solid fa-anchor"></i> New Record</button>
        <button id="searchBtn" class="btn-secondary"><i class="fa-solid fa-binoculars"></i> Search</button>
        <button id="exportBtn" class="btn-secondary" style="margin-left:auto"><i class="fa-solid fa-file-export"></i> Export Log</button>
      </div>

      <div id="searchContainer" class="search-container">
        <h3 style="margin-bottom:20px; color: var(--gold-light); font-family: 'Playfair Display', serif;">Search Naval Database</h3>
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="Enter name, rank, or CDC number..."/>
          <button id="searchSubmit" class="btn-primary"><i class="fa-solid fa-search"></i> Search</button>
        </div>
        <div class="date-search">
          <input type="date" id="dateFrom" placeholder="From Date"/>
          <input type="date" id="dateTo" placeholder="To Date"/>
          <button id="dateSearch" class="btn-secondary"><i class="fa-solid fa-calendar"></i> Date Filter</button>
        </div>
      </div>

      <!-- Title Selection Dialog -->
      <div id="titleDialog" class="title-dialog">
        <h2 class="form-title"><i class="fa-solid fa-file-shield"></i> Select Document Type</h2>
        <div class="title-options">
          <div class="title-option" id="newCDCOption">
            <i class="fa-solid fa-file-certificate"></i>
            <h3>NEW CDC</h3>
            <p>Issue new seaman's document</p>
          </div>
          <div class="title-option" id="revalidationOption">
            <i class="fa-solid fa-file-contract"></i>
            <h3>REVALIDATION</h3>
            <p>Renew existing documents</p>
          </div>
        </div>

        <div class="sub-options" id="revalidationSubOptions">
          <h4 style="color: var(--gold-light); margin-bottom: 20px; font-size: 18px; font-family: 'Playfair Display', serif;">Select Personnel Type</h4>
          <div class="title-options" style="grid-template-columns:1fr 1fr;margin-top:20px">
            <div class="title-option" id="crewOption">
              <i class="fa-solid fa-user-helmet-safety"></i>
              <h4>CREW</h4>
            </div>
            <div class="title-option" id="officerOption">
              <i class="fa-solid fa-user-tie"></i>
              <h4>OFFICER</h4>
            </div>
          </div>

          <!-- Dialog-only docs -->
          <div class="checkbox-group hidden-field" id="crewDocsTemplate">
            <div class="checkbox-section-title">Crew Certificates</div>
            <div class="checkbox-row">
              <div class="checkbox-item"><input type="checkbox" name="crewCertificates" value="4-Ticket" id="crew_4ticket"><label for="crew_4ticket"><i class="fa-solid fa-ticket"></i> 4-Ticket</label></div>
              <div class="checkbox-item"><input type="checkbox" name="crewCertificates" value="PSC" id="crew_psc"><label for="crew_psc"><i class="fa-solid fa-shield"></i> PSC</label></div>
              <div class="checkbox-item"><input type="checkbox" name="crewCertificates" value="TANKER" id="crew_TANKER"><label for="crew_TANKER"><i class="fa-solid fa-oil-well"></i> TANKER</label></div>
              <div class="checkbox-item"><input type="checkbox" name="crewCertificates" value="CMC" id="crew_cmc"><label for="crew_cmc"><i class="fa-solid fa-radio"></i> CMC</label></div>
            </div>
          </div>

          <div class="checkbox-group hidden-field" id="officerDocsTemplate">
            <div class="checkbox-section-title">Officer Certificates</div>
            <div class="checkbox-row">
              <div class="checkbox-item"><input type="checkbox" name="officerCertificates" value="AFF" id="off_aff"><label for="off_aff"><i class="fa-solid fa-fire-extinguisher"></i> AFF</label></div>
              <div class="checkbox-item"><input type="checkbox" name="officerCertificates" value="PSC" id="off_psc"><label for="off_psc"><i class="fa-solid fa-shield-halved"></i> PSC</label></div>
              <div class="checkbox-item"><input type="checkbox" name="officerCertificates" value="MFA" id="off_mfa"><label for="off_mfa"><i class="fa-solid fa-syringe"></i> MFA</label></div>
              <div class="checkbox-item"><input type="checkbox" name="officerCertificates" value="CMC" id="off_cmc"><label for="off_cmc"><i class="fa-solid fa-satellite-dish"></i> CMC</label></div>
              <div class="checkbox-item"><input type="checkbox" name="officerCertificates" value="G.O.C" id="off_gdc"><label for="off_gdc"><i class="fa-solid fa-id-card"></i> G.O.C</label></div>
              <div class="checkbox-item"><input type="checkbox" name="officerCertificates" value="C.O.C" id="off_cdc"><label for="off_cdc"><i class="fa-solid fa-id-card"></i> C.O.C</label></div>
            </div>
          </div>
        </div>

        <div style="margin-top:40px; display: flex; gap: 20px; justify-content: center;">
          <button id="confirmTitle" class="btn-primary"><i class="fa-solid fa-check-double"></i> Confirm</button>
          <button id="cancelTitle" class="btn-secondary"><i class="fa-solid fa-xmark"></i> Cancel</button>
        </div>
      </div>

      <!-- Main Form Container -->
      <div id="formContainer" class="form-container">
        <h2 class="form-title"><i class="fa-solid fa-user-astronaut"></i> <span id="formTitleText">Naval Personnel Record</span></h2>
        <form id="profileForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="name"><i class="fa-solid fa-id-card"></i> Full Name</label>
              <input type="text" id="name" required/>
            </div>
            <div class="form-group">
              <label for="rank"><i class="fa-solid fa-ranks"></i> Rank</label>
              <select id="rank" required>
                <option value="">Select Rank</option>
              </select>
            </div>
            <div class="form-group">
              <label for="cdcNumber"><i class="fa-solid fa-file-contract"></i> CDC Number</label>
              <input type="text" id="cdcNumber" required/>
            </div>
            <div class="form-group">
              <label for="phone"><i class="fa-solid fa-phone"></i> Contact Number</label>
              <input type="tel" id="phone" required/>
            </div>
            <div class="form-group">
              <label for="address"><i class="fa-solid fa-location-dot"></i> Address</label>
              <textarea id="address" required rows="1"></textarea>
            </div>
            <div class="form-group">
              <label for="passportNumber"><i class="fa-solid fa-passport"></i> Passport Number</label>
              <input type="text" id="passportNumber"/>
            </div>
            <div class="form-group">
              <label for="passportExpiry"><i class="fa-solid fa-calendar-xmark"></i> Passport Expiry</label>
              <input type="text" id="passportExpiry" placeholder="DD/MM/YYYY"/>
            </div>

            <!-- NEW CDC Only -->
            <div class="form-group hidden-field new-cdc-only">
              <label for="nrc"><i class="fa-solid fa-fingerprint"></i> NRC Number</label>
              <input type="text" id="nrc" placeholder="e.g., 12/ABC(N)123456"/>
            </div>
            <div class="form-group hidden-field new-cdc-only">
              <label for="fatherName"><i class="fa-solid fa-user"></i> Father's Name</label>
              <input type="text" id="fatherName"/>
            </div>
            <div class="form-group hidden-field new-cdc-only">
              <label for="motherName"><i class="fa-solid fa-user"></i> Mother's Name</label>
              <input type="text" id="motherName"/>
            </div>
            <div class="form-group hidden-field new-cdc-only">
              <label for="birthdate"><i class="fa-solid fa-cake-candles"></i> Birthdate</label>
              <input type="text" id="birthdate" placeholder="DD/MM/YYYY" pattern="\d{2}/\d{2}/\d{4}"/>
            </div>
            <div class="form-group hidden-field new-cdc-only">
              <label for="placeOfBirth"><i class="fa-solid fa-map-location-dot"></i> Place of Birth</label>
              <input type="text" id="placeOfBirth" placeholder="e.g., Yangon, Myanmar"/>
            </div>
            <div class="form-group hidden-field new-cdc-only">
              <label for="distinguishingMark"><i class="fa-solid fa-marker"></i> Distinguishing Mark</label>
              <input type="text" id="distinguishingMark" placeholder="Visible marks"/>
            </div>
            <div class="form-group hidden-field new-cdc-only">
              <label for="fees"><i class="fa-solid fa-sack-dollar"></i> Fees Amount ($)</label>
              <input type="number" id="fees"/>
            </div>
            <div class="form-group hidden-field new-cdc-only">
              <label for="feesPercentage"><i class="fa-solid fa-chart-line"></i> Payment Status (%)</label>
              <input type="number" id="feesPercentage" min="0" max="100"/>
              <div class="progress-bar"><div class="progress" id="feesProgress"></div></div>
            </div>

            <div class="form-group" style="grid-column:1/-1">
              <label for="remark"><i class="fa-solid fa-note-sticky"></i> Remarks</label>
              <textarea id="remark" rows="3" placeholder="Additional notes and observations..."></textarea>
            </div>
          </div>

          <!-- Webcam -->
          <div class="webcam-container">
            <div class="checkbox-section-title">Personnel Photograph</div>
            <div class="webcam-preview" id="webcamPreview">
              <i class="fa-solid fa-camera" style="font-size:60px;opacity:.5; color: var(--gold-primary);"></i>
            </div>
            <div class="webcam-controls">
              <button type="button" id="startCamera" class="btn-secondary"><i class="fa-solid fa-video"></i> Start Camera</button>
              <button type="button" id="capturePhoto" class="btn-secondary" disabled><i class="fa-solid fa-camera-retro"></i> Capture</button>
              <button type="button" id="retakePhoto" class="btn-secondary" disabled><i class="fa-solid fa-rotate-left"></i> Retake</button>
            </div>
            <input type="hidden" id="profilePhoto"/>
          </div>

          <!-- Revalidation docs -->
          <div id="revalidationDocsContainer" class="checkbox-group hidden-field"></div>

          <!-- NEW CDC docs -->
          <div class="checkbox-group hidden-field new-cdc-only">
            <div class="checkbox-section">
              <div class="checkbox-section-title">Core Training Certificates</div>
              <div class="checkbox-row">
                <div class="checkbox-item"><input type="checkbox" id="bst" name="certificates" value="BST"><label for="bst"><i class="fa-solid fa-person-swimming"></i> BST</label></div>
                <div class="checkbox-item"><input type="checkbox" id="pd" name="certificates" value="PD"><label for="pd"><i class="fa-solid fa-person-burst"></i> PD</label></div>
                <div class="checkbox-item"><input type="checkbox" id="pe" name="certificates" value="PE"><label for="pe"><i class="fa-solid fa-fire"></i> PE</label></div>
                <div class="checkbox-item"><input type="checkbox" id="cck" name="certificates" value="CCK"><label for="cck"><i class="fa-solid fa-utensils"></i> CCK</label></div>
              </div>
            </div>
            <div class="checkbox-section">
              <div class="checkbox-section-title">Additional Certifications</div>
              <div class="checkbox-row">
                <div class="checkbox-item"><input type="checkbox" id="ssa" name="certificates" value="SSA"><label for="ssa"><i class="fa-solid fa-shield-halved"></i> SSA</label></div>
                <div class="checkbox-item"><input type="checkbox" id="dsd" name="certificates" value="DSD"><label for="dsd"><i class="fa-solid fa-radiation"></i> DSD</label></div>
                <div class="checkbox-item"><input type="checkbox" id="cdc" name="certificates" value="CDC"><label for="cdc"><i class="fa-solid fa-id-card"></i> CDC</label></div>
                <div class="checkbox-item"><input type="checkbox" id="cmc" name="certificates" value="CMC"><label for="cmc"><i class="fa-solid fa-radio"></i> CMC</label></div>
              </div>
            </div>
            <div class="checkbox-section">
              <div class="checkbox-section-title">Specialized Training</div>
              <div class="checkbox-row">
                <div class="checkbox-item"><input type="checkbox" id="pscSpecial" name="certificates" value="PSC"><label for="pscSpecial"><i class="fa-solid fa-shield"></i> PSC</label></div>
                <div class="checkbox-item"><input type="checkbox" id="tff" name="certificates" value="TFF"><label for="tff"><i class="fa-solid fa-oil-well"></i> TFF</label></div>
                <div class="checkbox-item"><input type="checkbox" id="aio" name="certificates" value="AIO"><label for="aio"><i class="fa-solid fa-ship"></i> AIO</label></div>
                <div class="checkbox-item"><input type="checkbox" id="sid" name="certificates" value="SID"><label for="sid"><i class="fa-solid fa-satellite"></i> SID</label></div>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" id="saveBtn"><i class="fa-solid fa-floppy-disk"></i> Archive Record</button>
            <button type="button" id="cancelBtn" class="btn-secondary"><i class="fa-solid fa-ban"></i> Cancel</button>
            <button type="button" id="updateBtn" class="btn-primary hidden-field"><i class="fa-solid fa-file-pen"></i> Update Record</button>
          </div>
        </form>
      </div>

      <div id="profileCards" class="profile-cards">
        <div class="no-results" id="noResults">
          <i class="fa-solid fa-satellite"></i><br/>
          Establishing Connection to Naval Database...
        </div>
      </div>
    </div>

    <footer>
      <p><i class="fa-solid fa-anchor"></i> NAVAL COMMAND CENTER &copy; 2025 - All Naval Rights Secured <i class="fa-solid fa-shield"></i></p>
    </footer>
  </div>

  <script>
    const firebaseConfig={
      apiKey:"AIzaSyDP34-uI6YNf56YUax0zLQ7y_TWad52rA0",
      authDomain:"seameandatabase.firebaseapp.com",
      projectId:"seameandatabase",
      storageBucket:"seameandatabase.firebasestorage.app",
      messagingSenderId:"1078604355486",
      appId:"G-16GVDL26Q3"
    };

    firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();
    const auth=firebase.auth();

    let profiles=[];
    let selectedTitle='';
    let selectedRevalidationType='';
    let stream=null;
    let capturedPhoto=null;
    let editingProfileId = null;

    const loading=document.getElementById('loading');
    const loadingText=document.getElementById('loadingText');
    const syncIndicator=document.getElementById('syncIndicator');
    const syncStatus=document.getElementById('syncStatus');
    const loginContainer=document.getElementById('loginContainer');
    const loginForm=document.getElementById('loginForm');
    const mainContent=document.getElementById('mainContent');
    const userInfo=document.getElementById('userInfo');
    const userEmail=document.getElementById('userEmail');
    const logoutBtn=document.getElementById('logoutBtn');
    const exportBtn=document.getElementById('exportBtn');
    const addDataBtn=document.getElementById('addDataBtn');
    const searchBtn=document.getElementById('searchBtn');
    const searchContainer=document.getElementById('searchContainer');
    const formContainer=document.getElementById('formContainer');
    const profileForm=document.getElementById('profileForm');
    const profileCards=document.getElementById('profileCards');
    const searchInput=document.getElementById('searchInput');
    const searchSubmit=document.getElementById('searchSubmit');
    const dateFrom=document.getElementById('dateFrom');
    const dateTo=document.getElementById('dateTo');
    const dateSearch=document.getElementById('dateSearch');
    const cancelBtn=document.getElementById('cancelBtn');
    const noResults=document.getElementById('noResults');
    const feesPercentage=document.getElementById('feesPercentage');
    const feesProgress=document.getElementById('feesProgress');
    const formTitleText = document.getElementById('formTitleText');
    const saveBtn = document.getElementById('saveBtn');
    const updateBtn = document.getElementById('updateBtn');

    const titleDialog=document.getElementById('titleDialog');
    const newCDCOption=document.getElementById('newCDCOption');
    const revalidationOption=document.getElementById('revalidationOption');
    const revalidationSubOptions=document.getElementById('revalidationSubOptions');
    const crewOption=document.getElementById('crewOption');
    const officerOption=document.getElementById('officerOption');
    const confirmTitle=document.getElementById('confirmTitle');
    const cancelTitle=document.getElementById('cancelTitle');

    const crewDocsTemplate=document.getElementById('crewDocsTemplate');
    const officerDocsTemplate=document.getElementById('officerDocsTemplate');
    const revalidationDocsContainer=document.getElementById('revalidationDocsContainer');

    const webcamPreview=document.getElementById('webcamPreview');
    const startCamera=document.getElementById('startCamera');
    const capturePhoto=document.getElementById('capturePhoto');
    const retakePhoto=document.getElementById('retakePhoto');
    const profilePhoto=document.getElementById('profilePhoto');
    const rankSelect=document.getElementById('rank');

    document.addEventListener('DOMContentLoaded',initApp);
    loginForm.addEventListener('submit',loginUser);
    logoutBtn.addEventListener('click',logoutUser);
    exportBtn.addEventListener('click',exportToCSV);
    addDataBtn.addEventListener('click',showTitleDialog);
    searchBtn.addEventListener('click',showSearch);
    profileForm.addEventListener('submit',saveProfile);
    searchSubmit.addEventListener('click',searchProfiles);
    dateSearch.addEventListener('click',searchByDate);
    cancelBtn.addEventListener('click',hideForm);
    updateBtn.addEventListener('click', updateProfile);
    feesPercentage.addEventListener('input',updateProgressBar);

    newCDCOption.addEventListener('click',()=>selectTitle('NEW CDC'));
    revalidationOption.addEventListener('click',()=>selectTitle('REVALIDATION'));
    crewOption.addEventListener('click',()=>selectRevalidationType('CREW'));
    officerOption.addEventListener('click',()=>selectRevalidationType('OFFICER'));
    confirmTitle.addEventListener('click',confirmTitleSelection);
    cancelTitle.addEventListener('click',hideTitleDialog);

    startCamera.addEventListener('click',startWebcam);
    capturePhoto.addEventListener('click',captureWebcam);
    retakePhoto.addEventListener('click',retakeWebcam);

    function initApp(){
      updateSyncStatus('Initializing Naval Systems...','syncing');
      auth.onAuthStateChanged(user=>{
        if(user){
          userEmail.textContent=user.email;
          userInfo.style.display='flex';
          loginContainer.style.display='none';
          mainContent.style.display='block';
          updateSyncStatus('Naval Network Active','connected');
          loadDataFromFirebase();
        }else{
          userInfo.style.display='none';
          loginContainer.style.display='block';
          mainContent.style.display='none';
          updateSyncStatus('Authentication Required','error');
        }
      });
    }

    async function loginUser(e){
      e.preventDefault();
      const email=document.getElementById('email').value;
      const password=document.getElementById('password').value;
      showLoading('Verifying Security Credentials...');
      try{
        await auth.signInWithEmailAndPassword(email,password);
      }catch(err){
        alert('Access Denied: '+err.message);
      }finally{hideLoading()}
    }

    async function logoutUser(){
      showLoading('Terminating Secure Session...');
      try{await auth.signOut()}catch(err){/* noop */}finally{hideLoading()}
    }

    function updateSyncStatus(message,status='connected'){
      syncStatus.textContent=message;
      syncIndicator.className='sync-indicator '+status;
    }

    async function loadDataFromFirebase(){
      showLoading('Accessing Naval Records...');
      try{
        const snapshot=await db.collection('profiles').orderBy('timestamp','desc').get();
        profiles=[];
        snapshot.forEach(doc=>{const p=doc.data();p.id=doc.id;profiles.push(p)});
        updateSyncStatus(`Active - ${profiles.length} Personnel Records`,'connected');
        displayProfiles(profiles);
      }catch(error){
        try{
          const snapshot=await db.collection('profiles').get();
          profiles=[];
          snapshot.forEach(doc=>{const p=doc.data();p.id=doc.id;profiles.push(p)});
          displayProfiles(profiles);
        }catch(e){
          updateSyncStatus('Network Connection Error','error');
        }
      }finally{hideLoading()}
    }

    async function saveProfile(e){
      e.preventDefault();
      const selectedCertificates=[];
      if(selectedTitle==='NEW CDC'){
        document.querySelectorAll('input[name="certificates"]:checked').forEach(cb=>selectedCertificates.push(cb.value));
      }else if(selectedTitle==='REVALIDATION'){
        if(selectedRevalidationType==='CREW'){
          revalidationDocsContainer.querySelectorAll('input[name="crewCertificates"]:checked').forEach(cb=>selectedCertificates.push(cb.value));
        }else if(selectedRevalidationType==='OFFICER'){
          revalidationDocsContainer.querySelectorAll('input[name="officerCertificates"]:checked').forEach(cb=>selectedCertificates.push(cb.value));
        }
      }

      const profile={
        name:document.getElementById('name').value,
        rank:document.getElementById('rank').value,
        cdcNumber:document.getElementById('cdcNumber').value,
        phone:document.getElementById('phone').value,
        address:document.getElementById('address').value,
        passportNumber:document.getElementById('passportNumber').value,
        passportExpiry:document.getElementById('passportExpiry').value,
        remark:document.getElementById('remark').value,
        title:selectedTitle,
        revalidationType:selectedRevalidationType,
        profilePhoto:capturedPhoto,
        certificates:selectedCertificates.join(', '),
        timestamp:firebase.firestore.FieldValue.serverTimestamp()
      };

      if(selectedTitle==='NEW CDC'){
        profile.nrc=document.getElementById('nrc').value;
        profile.fatherName=document.getElementById('fatherName').value;
        profile.motherName=document.getElementById('motherName').value;
        profile.birthdate=document.getElementById('birthdate').value;
        profile.placeOfBirth=document.getElementById('placeOfBirth').value;
        profile.distinguishingMark=document.getElementById('distinguishingMark').value;
        profile.fees=document.getElementById('fees').value;
        profile.feesPercentage=document.getElementById('feesPercentage').value;
      }

      showLoading('Securing Record to Naval Database...');
      try{
        await db.collection('profiles').add(profile);
        alert('SUCCESS: Personnel record archived in naval database.');
        hideForm();
        await loadDataFromFirebase();
      }catch(err){
        alert('ERROR: '+err.message);
      }finally{hideLoading()}
    }

    async function updateProfile() {
      if (!editingProfileId) return;
      
      const selectedCertificates=[];
      if(selectedTitle==='NEW CDC'){
        document.querySelectorAll('input[name="certificates"]:checked').forEach(cb=>selectedCertificates.push(cb.value));
      }else if(selectedTitle==='REVALIDATION'){
        if(selectedRevalidationType==='CREW'){
          revalidationDocsContainer.querySelectorAll('input[name="crewCertificates"]:checked').forEach(cb=>selectedCertificates.push(cb.value));
        }else if(selectedRevalidationType==='OFFICER'){
          revalidationDocsContainer.querySelectorAll('input[name="officerCertificates"]:checked').forEach(cb=>selectedCertificates.push(cb.value));
        }
      }

      const profile={
        name:document.getElementById('name').value,
        rank:document.getElementById('rank').value,
        cdcNumber:document.getElementById('cdcNumber').value,
        phone:document.getElementById('phone').value,
        address:document.getElementById('address').value,
        passportNumber:document.getElementById('passportNumber').value,
        passportExpiry:document.getElementById('passportExpiry').value,
        remark:document.getElementById('remark').value,
        title:selectedTitle,
        revalidationType:selectedRevalidationType,
        profilePhoto:capturedPhoto || document.getElementById('profilePhoto').value,
        certificates:selectedCertificates.join(', '),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };

      if(selectedTitle==='NEW CDC'){
        profile.nrc=document.getElementById('nrc').value;
        profile.fatherName=document.getElementById('fatherName').value;
        profile.motherName=document.getElementById('motherName').value;
        profile.birthdate=document.getElementById('birthdate').value;
        profile.placeOfBirth=document.getElementById('placeOfBirth').value;
        profile.distinguishingMark=document.getElementById('distinguishingMark').value;
        profile.fees=document.getElementById('fees').value;
        profile.feesPercentage=document.getElementById('feesPercentage').value;
      }

      showLoading('Updating Naval Record...');
      try{
        await db.collection('profiles').doc(editingProfileId).update(profile);
        alert('SUCCESS: Personnel record updated.');
        hideForm();
        await loadDataFromFirebase();
      }catch(err){
        alert('ERROR: '+err.message);
      }finally{
        hideLoading();
        editingProfileId = null;
      }
    }

    async function deleteProfile(profileId) {
      if (!confirm('WARNING: This action will permanently delete this naval record. Proceed?')) return;
      
      showLoading('Deleting Naval Record...');
      try {
        await db.collection('profiles').doc(profileId).delete();
        profiles = profiles.filter(p => p.id !== profileId);
        displayProfiles(profiles);
        updateSyncStatus(`Active - ${profiles.length} Personnel Records`, 'connected');
        alert('Naval record permanently deleted.');
      } catch (err) {
        alert('ERROR deleting record: ' + err.message);
      } finally {
        hideLoading();
      }
    }

    function editProfile(profile) {
      editingProfileId = profile.id;
      selectedTitle = profile.title || '';
      selectedRevalidationType = profile.revalidationType || '';
      
      // Populate form fields
      document.getElementById('name').value = profile.name || '';
      document.getElementById('cdcNumber').value = profile.cdcNumber || '';
      document.getElementById('phone').value = profile.phone || '';
      document.getElementById('address').value = profile.address || '';
      document.getElementById('passportNumber').value = profile.passportNumber || '';
      document.getElementById('passportExpiry').value = profile.passportExpiry || '';
      document.getElementById('remark').value = profile.remark || '';
      
      // Set profile photo if exists
      if (profile.profilePhoto) {
        capturedPhoto = profile.profilePhoto;
        profilePhoto.value = profile.profilePhoto;
        webcamPreview.innerHTML = `<img src="${profile.profilePhoto}" alt="Profile Photo">`;
      }
      
      // Handle NEW CDC specific fields
      if (profile.title === 'NEW CDC') {
        document.getElementById('nrc').value = profile.nrc || '';
        document.getElementById('fatherName').value = profile.fatherName || '';
        document.getElementById('motherName').value = profile.motherName || '';
        document.getElementById('birthdate').value = profile.birthdate || '';
        document.getElementById('placeOfBirth').value = profile.placeOfBirth || '';
        document.getElementById('distinguishingMark').value = profile.distinguishingMark || '';
        document.getElementById('fees').value = profile.fees || '';
        document.getElementById('feesPercentage').value = profile.feesPercentage || '';
        updateProgressBar();
        
        // Check certificates checkboxes
        if (profile.certificates) {
          const certs = profile.certificates.split(', ');
          document.querySelectorAll('input[name="certificates"]').forEach(cb => {
            cb.checked = certs.includes(cb.value);
          });
        }
      }
      
      // Handle REVALIDATION
      if (profile.title === 'REVALIDATION') {
        // Check certificates checkboxes
        if (profile.certificates) {
          const certs = profile.certificates.split(', ');
          const certsContainer = selectedRevalidationType === 'CREW' ? 
            'crewCertificates' : 'officerCertificates';
          
          // We need to render the revalidation docs first
          renderRevalidationDocsIntoForm();
          revalidationDocsContainer.querySelectorAll(`input[name="${certsContainer}"]`).forEach(cb => {
            cb.checked = certs.includes(cb.value);
          });
        }
      }
      
      // Update form UI - IMPORTANT: Call updateFormFields BEFORE setting rank value
      formTitleText.textContent = 'Edit Naval Record';
      saveBtn.classList.add('hidden-field');
      updateBtn.classList.remove('hidden-field');
      
      // First update the rank options based on title and revalidation type
      updateFormFields();
      
      // THEN set the rank value - This is the FIX for rank selection issue
      setTimeout(() => {
        document.getElementById('rank').value = profile.rank || '';
      }, 50);
      
      formContainer.style.display = 'block';
      formContainer.scrollIntoView({behavior: 'smooth'});
    }

    async function exportToCSV(){
      if(profiles.length===0){alert('No naval records to export');return}
      showLoading('Generating Naval Log...');
      try{
        let csv="Name,Rank,CDC Number,Phone,Address,Passport Number,Passport Expiry,Title,Revalidation Type,Remark,Certificates";
        if(profiles.some(p=>p.title==='NEW CDC')){
          csv+=",NRC,Father's Name,Mother's Name,Birthdate,Place of Birth,Distinguishing Mark,Fees,Fees Percentage";
        }
        csv+="\n";
        profiles.forEach(p=>{
          const row=[
            `"${p.name}"`,`"${p.rank}"`,`"${p.cdcNumber}"`,`"${p.phone}"`,`"${p.address}"`,
            `"${p.passportNumber||''}"`,`"${p.passportExpiry||''}"`,`"${p.title||''}"`,`"${p.revalidationType||''}"`,
            `"${p.remark||''}"`,`"${p.certificates||''}"`
          ];
          if(p.title==='NEW CDC'){
            row.push(
              `"${p.nrc||''}"`,`"${p.fatherName||''}"`,`"${p.motherName||''}"`,`"${p.birthdate||''}"`,
              `"${p.placeOfBirth||''}"`,`"${p.distinguishingMark||''}"`,`"${p.fees||''}"`,`"${p.feesPercentage||''}"`
            );
          }
          csv+=row.join(',')+"\n";
        });
        const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
        const url=URL.createObjectURL(blob);
        const a=document.createElement('a');
        a.href=url;a.download='naval_records_export.csv';a.style.visibility='hidden';
        document.body.appendChild(a);a.click();document.body.removeChild(a);
        updateSyncStatus('Export Complete','connected');
      }catch(err){alert('Export failed: '+err.message)}finally{hideLoading()}
    }

    function showLoading(text='Processing...'){loadingText.textContent=text;loading.style.display='block'}
    function hideLoading(){loading.style.display='none'}

    function showTitleDialog(){
      titleDialog.style.display='block';
      searchContainer.style.display='none';
      formContainer.style.display='none';
      resetTitleOptions();
      titleDialog.scrollIntoView({behavior:'smooth'});
    }

    function hideTitleDialog(){
      titleDialog.style.display='none';
      revalidationDocsContainer.innerHTML='';
      revalidationDocsContainer.classList.add('hidden-field');
    }

    function selectTitle(title){
      selectedTitle=title;
      if(title==='NEW CDC'){
        newCDCOption.classList.add('active');
        revalidationOption.classList.remove('active');
        revalidationSubOptions.classList.remove('active');
      }else if(title==='REVALIDATION'){
        revalidationOption.classList.add('active');
        newCDCOption.classList.remove('active');
        revalidationSubOptions.classList.add('active');
      }
    }

    function selectRevalidationType(type){
      selectedRevalidationType=type;
      if(type==='CREW'){
        crewOption.classList.add('active');
        officerOption.classList.remove('active');
      }else{
        officerOption.classList.add('active');
        crewOption.classList.remove('active');
      }
    }

    function confirmTitleSelection(){
      if(!selectedTitle){alert('Please select a document type');return}
      if(selectedTitle==='REVALIDATION' && !selectedRevalidationType){alert('Please select a revalidation type');return}
      hideTitleDialog();
      showForm();
      renderRevalidationDocsIntoForm();
    }

    function renderRevalidationDocsIntoForm(){
      revalidationDocsContainer.innerHTML='';
      revalidationDocsContainer.classList.add('hidden-field');
      if(selectedTitle!=='REVALIDATION') return;

      const source=(selectedRevalidationType==='CREW')?crewDocsTemplate:officerDocsTemplate;
      if(!source) return;

      const clone=source.cloneNode(true);
      clone.removeAttribute('id');
      clone.querySelectorAll('input[type="checkbox"]').forEach(cb=>{cb.checked=false;cb.disabled=false;});
      clone.classList.remove('hidden-field');
      clone.style.display='block';

      revalidationDocsContainer.appendChild(clone);
      revalidationDocsContainer.classList.remove('hidden-field');
    }

    function resetTitleOptions(){
      selectedTitle='';selectedRevalidationType='';
      [newCDCOption,revalidationOption,crewOption,officerOption,revalidationSubOptions].forEach(el=>el.classList.remove('active'));
      revalidationDocsContainer.innerHTML='';
      revalidationDocsContainer.classList.add('hidden-field');
      document.querySelectorAll('input[name="crewCertificates"],input[name="officerCertificates"]').forEach(cb=>cb.checked=false);
    }

    function showForm(){
      formContainer.style.display='block';
      searchContainer.style.display='none';
      profileForm.reset();
      updateProgressBar();
      editingProfileId = null;

      formTitleText.textContent = 'Naval Personnel Record';
      saveBtn.classList.remove('hidden-field');
      updateBtn.classList.add('hidden-field');

      if(stream){stream.getTracks().forEach(t=>t.stop());stream=null}
      webcamPreview.innerHTML='<i class="fa-solid fa-camera" style="font-size:60px;opacity:.5; color: var(--gold-primary);"></i>';
      capturedPhoto=null;capturePhoto.disabled=true;retakePhoto.disabled=true;

      updateFormFields();
      formContainer.scrollIntoView({behavior:'smooth'});
    }

    function updateFormFields(){
      const newCDCOnlyFields=document.querySelectorAll('.new-cdc-only');
      if(selectedTitle==='NEW CDC'){
        newCDCOnlyFields.forEach(f=>f.classList.remove('hidden-field'));
        // Store current rank value before resetting options
        const currentRank = rankSelect.value;
        
        // Set NEW CDC ranks
        rankSelect.innerHTML=`
          <option value="">Select Rank</option>
          <option value="D/R">D/R</option>
          <option value="E/R">E/R</option>
          <option value="ET/R">ET/R</option>
          <option value="G/S">G/S</option>
          <option value="C/CK">C/CK</option>
        `;
        
        // Restore rank value if editing
        if (editingProfileId && currentRank) {
          rankSelect.value = currentRank;
        }
        
        revalidationDocsContainer.classList.add('hidden-field');
        revalidationDocsContainer.innerHTML='';
      }else if(selectedTitle==='REVALIDATION'){
        newCDCOnlyFields.forEach(f=>f.classList.add('hidden-field'));
        
        // Store current rank value before resetting options
        const currentRank = rankSelect.value;
        
        if(selectedRevalidationType==='OFFICER'){
          rankSelect.innerHTML=`
            <option value="">Select Officer Rank</option>
            <option value="Master">Master</option>
            <option value="C/O">C/O</option>
            <option value="2/O">2/O</option>
            <option value="3/O">3/O</option>
            <option value="C/E">C/E</option>
            <option value="2/E">2/E</option>
            <option value="3/E">3/E</option>
            <option value="4/E">4/E</option>
            <option value="E/E">E/E</option>
          `;
        }else{
          rankSelect.innerHTML=`
            <option value="">Select Crew Rank</option>
            <option value="BSN">BSN</option>
            <option value="A/B">A/B</option>
            <option value="O/S">O/S</option>
            <option value="FTR">FTR</option>
            <option value="OLR">OLR</option>
            <option value="WPR">WPR</option>
            <option value="D/C">D/C</option>
            <option value="E/C">E/C</option>
            <option value="Cruise Crew">Cruise Crew</option>
          `;
        }
        
        // Restore rank value if editing
        if (editingProfileId && currentRank) {
          rankSelect.value = currentRank;
        }
      }
    }

    function hideForm(){
      formContainer.style.display='none';
      resetTitleOptions();
      editingProfileId = null;
    }

    function showSearch(){
      searchContainer.style.display='block';
      formContainer.style.display='none';
      titleDialog.style.display='none';
      searchContainer.scrollIntoView({behavior:'smooth'});
    }

    function updateProgressBar(){
      const pct=Number(feesPercentage.value||0);
      feesProgress.style.width=`${pct}%`;
      if(pct<30) feesProgress.style.background='#ef4444';
      else if(pct<70) feesProgress.style.background='#f59e0b';
      else feesProgress.style.background='#10b981';
    }

    function searchProfiles(){
      const term=(searchInput.value||'').toLowerCase();
      const filtered=profiles.filter(p=>
        (p.name&&p.name.toLowerCase().includes(term))||
        (p.rank&&p.rank.toLowerCase().includes(term))||
        (p.cdcNumber&&p.cdcNumber.toLowerCase().includes(term))
      );
      displayProfiles(filtered);
    }

    function searchByDate(){
      const fromDate=dateFrom.value,toDate=dateTo.value;
      if(!fromDate&&!toDate){alert('Please enter at least one date');return}
      const filtered=profiles.filter(p=>{
        if(!p.timestamp) return false;
        const d=new Date(p.timestamp.seconds*1000);
        const from=fromDate?new Date(fromDate):new Date(0);
        const to=toDate?new Date(toDate):new Date();
        from.setHours(0,0,0,0);to.setHours(23,59,59,999);
        return d>=from && d<=to;
      });
      displayProfiles(filtered);
    }

    function displayProfiles(list){
      profileCards.innerHTML='';
      if(list.length===0){
        noResults.innerHTML='<i class="fa-solid fa-magnifying-glass"></i><br>No matching naval records found.';
        noResults.style.display='block';
        profileCards.appendChild(noResults);
        return;
      }
      noResults.style.display='none';
      list.forEach(p=>{
        const card=document.createElement('div');card.className='profile-card';
        const initials=p.name?p.name.split(' ').map(n=>n[0]).join('').substring(0,2).toUpperCase():'??';
        card.innerHTML=`
          <div class="card-header">
            <div class="card-header-info">
              <div class="card-avatar">${initials}</div>
              <div><h3>${p.name}</h3><p>${p.rank}</p></div>
            </div>
            <div class="card-actions">
              <button class="btn-edit" data-id="${p.id}"><i class="fa-solid fa-edit"></i></button>
              <button class="btn-delete" data-id="${p.id}"><i class="fa-solid fa-trash"></i></button>
            </div>
          </div>
          <div class="card-body">
            <div class="card-details">
              <div class="card-detail"><span class="detail-label"><i class="fa-regular fa-id-card"></i> CDC</span><span class="detail-value">${p.cdcNumber}</span></div>
              <div class="card-detail"><span class="detail-label"><i class="fa-solid fa-phone"></i> Phone</span><span class="detail-value">${p.phone}</span></div>
              <div class="card-detail"><span class="detail-label"><i class="fa-solid fa-file"></i> Type</span><span class="detail-value">${p.title||'N/A'}</span></div>
              ${p.certificates?`<div class="card-detail"><span class="detail-label"><i class="fa-solid fa-certificate"></i> Documents</span><span class="detail-value" style="font-size:12px">${p.certificates}</span></div>`:''}
              ${p.title==='NEW CDC'?`
                <div class="card-detail"><span class="detail-label"><i class="fa-solid fa-wallet"></i> Fees</span><span class="detail-value">$${p.fees||'0'}</span></div>
                <div class="card-detail" style="border:none;margin-top:10px"><span class="detail-label">Payment Completion</span><span class="detail-value">${p.feesPercentage||'0'}%</span></div>
                <div class="progress-bar"><div class="progress" style="width:${p.feesPercentage||'0'}%;background:${(p.feesPercentage||0)<100?((p.feesPercentage||0)<50?'#ef4444':'#f59e0b'):'#10b981'}"></div></div>
              `:''}
            </div>
          </div>
        `;
        
        card.querySelector('.btn-edit').addEventListener('click', (e) => {
          e.stopPropagation();
          const profile = profiles.find(prof => prof.id === p.id);
          if (profile) editProfile(profile);
        });
        
        card.querySelector('.btn-delete').addEventListener('click', (e) => {
          e.stopPropagation();
          deleteProfile(p.id);
        });
        
        card.addEventListener('click',()=>{
          const titleText=p.title?`\n\nðŸ“‹ Document Type: ${p.title}`:'';
          const revText=p.revalidationType?`\nRevalidation Type: ${p.revalidationType}`:'';
          const certText=p.certificates?`\n\nðŸ“œ Certificates:\n${p.certificates}`:'';
          const passportText=p.passportNumber?`\n\nðŸ“‘ Passport:\nNumber: ${p.passportNumber}\nExpiry: ${p.passportExpiry||'N/A'}`:'';
          const remarkText=p.remark?`\n\nðŸ’¬ Remark:\n${p.remark}`:'';
          const newCDCText=p.title==='NEW CDC'
            ?`\n\nðŸ“ NEW CDC Details:\nNRC: ${p.nrc||'N/A'}\nFather: ${p.fatherName||'N/A'}\nMother: ${p.motherName||'N/A'}\nBirthdate: ${p.birthdate||'N/A'}\nPlace of Birth: ${p.placeOfBirth||'N/A'}\nMark: ${p.distinguishingMark||'N/A'}\nFees: $${p.fees||'0'}\nPaid: ${p.feesPercentage||'0'}%`
            :'';
          alert(`NAVAL PERSONNEL RECORD\n===================\nName: ${p.name}\nRank: ${p.rank}\nCDC: ${p.cdcNumber}\nPhone: ${p.phone}\nAddress: ${p.address}${titleText}${revText}${newCDCText}${certText}${passportText}${remarkText}`);
        });
        profileCards.appendChild(card);
      });
    }

    async function startWebcam(){
      try{
        stream=await navigator.mediaDevices.getUserMedia({video:true,audio:false});
        const video=document.createElement('video');
        video.srcObject=stream;video.autoplay=true;video.playsInline=true;
        webcamPreview.innerHTML='';webcamPreview.appendChild(video);
        capturePhoto.disabled=false;startCamera.disabled=true;
      }catch(err){alert('Unable to access camera. Please check permissions.')}
    }

    function captureWebcam(){
      if(!stream) return;
      const video=webcamPreview.querySelector('video');
      const canvas=document.createElement('canvas');
      const ctx=canvas.getContext('2d');
      canvas.width=video.videoWidth;canvas.height=video.videoHeight;
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      capturedPhoto=canvas.toDataURL('image/jpeg');profilePhoto.value=capturedPhoto;
      stream.getTracks().forEach(t=>t.stop());stream=null;
      const img=document.createElement('img');img.src=capturedPhoto;
      webcamPreview.innerHTML='';webcamPreview.appendChild(img);
      capturePhoto.disabled=true;retakePhoto.disabled=false;
    }

    function retakeWebcam(){
      capturedPhoto=null;profilePhoto.value='';
      webcamPreview.innerHTML='<i class="fa-solid fa-camera" style="font-size:60px;opacity:.5; color: var(--gold-primary);"></i>';
      capturePhoto.disabled=true;retakePhoto.disabled=true;startCamera.disabled=false;
    }
  </script>
</body>
</html>
